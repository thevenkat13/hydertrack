<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Transfer Document - AATM Education Management Portal</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 10px;
        }
        h1 { font-size: 2.5em; }
        h2 { font-size: 2em; }
        h3 { font-size: 1.75em; }
        h4 { font-size: 1.5em; }
        code {
            background-color: #ecf0f1;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
        }
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #bdc3c7;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #ecf0f1;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        strong {
            color: #2980b9;
        }
        hr {
            border: 0;
            height: 1px;
            background: #ecf0f1;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <h1>Knowledge Transfer Document</h1>
    <h2>AATM Education Management Portal</h2>

    <hr>

    <h3><strong>Page 1: High-Level Overview & Core Technologies</strong></h3>
    <h4><strong>1.1. Introduction</strong></h4>
    <p>The AATM Education Management Portal is a multi-tenant, role-based web application designed to streamline the management of students, partners, and affiliated institutions. It serves as a central hub for various user types, each with a dashboard tailored to their specific functions within the AATM ecosystem.</p>
    <p>The system's primary objectives are:</p>
    <ul>
        <li><strong>Centralized User & Partner Management:</strong> Provide administrators with tools to create, view, and manage different user roles such as PROs (Promotion and Outreach Partners), Counselors, College Admins, and Study Center (ADC) Admins.</li>
        <li><strong>Role-Based Access Control (RBAC):</strong> Ensure that users can only access the data and functionalities relevant to their role. For example, a Counselor can manage their own students but cannot manage PROs.</li>
        <li><strong>Automated Onboarding Communication:</strong> Automatically dispatch welcome emails containing login credentials and essential information to newly created users, ensuring a smooth onboarding process.</li>
        <li><strong>Data Aggregation & Reporting:</strong> Offer dashboard summaries (e.g., total students, total revenue) and provide functionalities for generating reports.</li>
    </ul>

    <h4><strong>1.2. System Architecture</strong></h4>
    <p>The application employs a traditional <strong>Client-Server architecture</strong>.</p>
    <ul>
        <li><strong>Client-Side (Frontend):</strong> The user interface is built with HTML, styled with CSS (using the Bootstrap 5 framework), and made dynamic and interactive with JavaScript (heavily utilizing the jQuery library). The dashboards function as <strong>Single-Page Applications (SPAs)</strong>, where content is loaded and swapped dynamically via AJAX without requiring full page reloads.</li>
        <li><strong>Server-Side (Backend):</strong> The backend logic is written in procedural <strong>PHP</strong>. It handles database operations, user authentication/authorization, and email notifications.</li>
        <li><strong>Database:</strong> A <strong>MySQL</strong> database (<code>education_db</code>) serves as the persistent data store for all application data.</li>
        <li><strong>Communication:</strong> The frontend and backend communicate asynchronously using <strong>AJAX</strong>. The frontend sends <code>POST</code> or <code>GET</code> requests to the PHP scripts, which process the requests and return data in <strong>JSON</strong> format.</li>
    </ul>

    <h4><strong>1.3. Core Technologies Stack</strong></h4>
    <table>
        <thead>
            <tr>
                <th>Layer</th>
                <th>Technology/Library</th>
                <th>Purpose</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Backend</strong></td>
                <td>PHP</td>
                <td>Core server-side scripting language for business logic.</td>
            </tr>
            <tr>
                <td></td>
                <td>MySQL</td>
                <td>Relational database for data storage.</td>
            </tr>
            <tr>
                <td></td>
                <td><strong>PHPMailer</strong></td>
                <td>A robust PHP library for sending emails via an SMTP server (like Gmail).</td>
            </tr>
            <tr>
                <td><strong>Frontend</strong></td>
                <td>HTML5, CSS3</td>
                <td>Structure and styling of the web pages.</td>
            </tr>
            <tr>
                <td></td>
                <td><strong>Bootstrap 5</strong></td>
                <td>Responsive CSS framework for layout and UI components (modals, cards).</td>
            </tr>
            <tr>
                <td></td>
                <td>JavaScript (ES6)</td>
                <td>Core language for client-side interactivity.</td>
            </tr>
            <tr>
                <td></td>
                <td><strong>jQuery</strong></td>
                <td>JS library used for simplified DOM manipulation, events, and AJAX.</td>
            </tr>
            <tr>
                <td></td>
                <td><strong>DataTables.js</strong></td>
                <td>A jQuery plugin for creating advanced, interactive HTML tables.</td>
            </tr>
            <tr>
                <td></td>
                <td><strong>jsPDF</strong></td>
                <td>A client-side JS library for generating PDF documents.</td>
            </tr>
            <tr>
                <td><strong>Protocol</strong></td>
                <td>HTTP/S, AJAX</td>
                <td>Communication between client and server.</td>
            </tr>
            <tr>
                <td><strong>Format</strong></td>
                <td>JSON</td>
                <td>Data interchange format for AJAX requests and responses.</td>
            </tr>
        </tbody>
    </table>

    <hr>

    <h3><strong>Page 2: The Configuration File (<code>config.php</code>)</strong></h3>
    <p>The <code>config.php</code> file is the foundational configuration file for the entire backend. It is included at the beginning of almost every PHP script and serves two critical purposes: establishing the database connection and defining email server credentials.</p>
    <p><strong>Any new deployment or change in server environment will require modifying this file.</strong></p>

    <h4><strong>2.1. Full Code Snippet</strong></h4>
    <pre><code>&lt;?php
/**
 * config.php (FINAL VERSION)
 * Holds all database and email configuration.
 */

// --- Database Credentials ---
define('DB_SERVER', 'localhost');
define('DB_USERNAME', 'root');
define('DB_PASSWORD', 'Yournewpassword'); // Your actual MySQL password
define('DB_NAME', 'education_db');

/*
 * --- Email Sending Credentials ---
 * IMPORTANT: SMTP_PASS requires a 16-character "App Password" from Google,
 * not your regular Gmail password, if 2-Factor Authentication is enabled.
 */
define('SMTP_HOST', 'smtp.gmail.com');      // The server to send email through
define('SMTP_USER', 'aatmacademy@gmail.com');  // Your Gmail address
define('SMTP_PASS', 'szhh suad bhnk tylg');  // Your 16-character App Password
define('SMTP_FROM_NAME', 'AATM Admissions');

/**
 * Attempt to connect to MySQL database
 */
$link = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);

// Check connection
if($link === false){
    die("ERROR: Could not connect. " . mysqli_connect_error());
}
?&gt;
</code></pre>

    <h4><strong>2.2. Key Sections Explained</strong></h4>
    <ol>
        <li><strong>Database Credentials:</strong>
            <ul>
                <li><code>DB_SERVER</code>: The hostname of the database server.</li>
                <li><code>DB_USERNAME</code>: The username to access the database.</li>
                <li><code>DB_PASSWORD</code>: The password for the database user.</li>
                <li><code>DB_NAME</code>: The name of the database.</li>
            </ul>
        </li>
        <li><strong>Email Sending Credentials (SMTP):</strong>
            <ul>
                <li><code>SMTP_HOST</code>: The address of the SMTP server.</li>
                <li><code>SMTP_USER</code>: The Gmail address from which emails will be sent.</li>
                <li><code>SMTP_PASS</code>: **Crucial Point:** This is a 16-digit "App Password" from Google Account settings, not the regular password.</li>
                <li><code>SMTP_FROM_NAME</code>: The name that appears in the "From" field of the email.</li>
            </ul>
        </li>
        <li><strong>Database Connection:</strong>
            <ul>
                <li>Uses <code>mysqli_connect()</code> to establish the connection.</li>
                <li>The connection object is stored in the <code>$link</code> variable.</li>
            </ul>
        </li>
    </ol>

    <hr>

    <h3><strong>Page 3: Backend Logic - The "Create User & Notify" Pattern</strong></h3>
    <h4><strong>3.1. The Standard Workflow</strong></h4>
    <ol>
        <li><strong>Session & Authorization:</strong> Verify logged-in user permissions.</li>
        <li><strong>Data Ingestion:</strong> Retrieve form data from <code>$_POST</code>.</li>
        <li><strong>Password Security:</strong> Hash the password using <code>password_hash()</code>.</li>
        <li><strong>Unique ID Generation:</strong> Create a custom, human-readable ID.</li>
        <li><strong>Database Insertion:</strong> Use a prepared SQL <code>INSERT</code> statement.</li>
        <li><strong>Email Notification:</strong> Send a welcome email using <code>PHPMailer</code>.</li>
        <li><strong>JSON Response:</strong> Send a JSON response back to the frontend.</li>
    </ol>

    <h4><strong>3.2. Code Example: <code>create_pro.php</code></strong></h4>
    <pre><code>&lt;?php
session_start();
header('Content-Type: application/json');
require_once 'config.php'; 

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;
require 'PHPMailer/Exception.php';
require 'PHPMailer/PHPMailer.php';
require 'PHPMailer/SMTP.php';

// 1. Session & Authorization Check
if (!isset($_SESSION['user_id']) || !in_array($_SESSION['user_role'], ['Super Admin', 'Admin'])) {
    http_response_code(401);
    die(json_encode(['status' => 'error', 'message' => 'Unauthorized']));
}

// 2. Data Ingestion & 3. Password Security
$plain_password = $_POST['password'] ?? '';
$hashed_password = password_hash($plain_password, PASSWORD_DEFAULT);

// 5. Database Insertion
$stmt = $link-&gt;prepare("INSERT INTO pros (...) VALUES (...)");
// ... bind params

if ($stmt-&gt;execute()) {
    // 4. Unique ID Generation
    $last_id = $stmt-&gt;insert_id;
    $pro_uid = "AATM-PRO" . $last_id;
    $link-&gt;query("UPDATE pros SET pro_uid = '{$pro_uid}' WHERE id = {$last_id}");

    // 6. Email Notification
    try {
        $mail = new PHPMailer(true);
        // ... mail configuration
        $mail-&gt;Subject = 'Welcome to AATM - Your PRO Account Details';
        $mail-&gt;Body = "Your details are...";
        $mail-&gt;send();
    } catch (Exception $e) {
        // ... handle mail error
    }
    
    // 7. JSON Response
    echo json_encode(['status' => 'success', 'message' => 'PRO created...']);
} else {
    echo json_encode(['status' => 'error', 'message' => 'Failed to create PRO.']);
}
?&gt;
</code></pre>

    <hr>

    <h3><strong>Page 4: Backend Logic - Unique ID Generation</strong></h3>
    <h4><strong>4.1. The ID Generation Algorithm</strong></h4>
    <ol>
        <li>Define a static prefix (e.g., <code>AATM-ADC</code>).</li>
        <li>Query the database for the last used ID.</li>
        <li>If an ID exists, strip the prefix, convert to an integer, increment, pad with leading zeros, and re-attach the prefix.</li>
        <li>If no ID exists, create the first one (e.g., <code>AATM-ADC001</code>).</li>
    </ol>

    <h4><strong>4.2. Code Snippet from <code>create_studycenter.php</code></strong></h4>
    <pre><code>&lt;?php
$uid_prefix = 'AATM-ADC';
$new_uid = '';

$sql_get_last_id = "SELECT study_center_uid FROM study_centers ORDER BY id DESC LIMIT 1";
$result = $link-&gt;query($sql_get_last_id);

if ($result &amp;&amp; $result-&gt;num_rows &gt; 0) {
    $last_row = $result-&gt;fetch_assoc();
    $last_uid = $last_row['study_center_uid'];
    $last_number = intval(str_replace($uid_prefix, '', $last_uid));
    $new_number = $last_number + 1;
    $new_uid = $uid_prefix . str_pad($new_number, 3, '0', STR_PAD_LEFT);
} else {
    $new_uid = $uid_prefix . '001';
}
?&gt;
</code></pre>

    <hr>

    <h3><strong>Page 5: Frontend Architecture - The SPA Dashboard</strong></h3>
    <h4><strong>5.1. The SPA Concept</strong></h4>
    <p>The dashboards are Single-Page Applications. A single HTML file contains all modules within hidden <code>&lt;div&gt;</code> containers. JavaScript is used to toggle the visibility of these containers based on user navigation, creating a fast, seamless experience without page reloads.</p>

    <h4><strong>5.2. Code Snippet: Module Switching in <code>admindashboard.html</code></strong></h4>
    <pre><code>&lt;!-- HTML Structure --&gt;
&lt;div class="list-group"&gt;
    &lt;a href="#" class="list-group-item" data-module="dashboard"&gt;Dashboard&lt;/a&gt;
    &lt;a href="#" class="list-group-item" data-module="pro"&gt;POP Management&lt;/a&gt;
&lt;/div&gt;

&lt;div class="module-content" id="dashboard-module"&gt;...&lt;/div&gt;
&lt;div class="module-content" id="pro-module" style="display: none;"&gt;...&lt;/div&gt;

&lt;script&gt;
// JavaScript Logic
$('.list-group-item-action').on('click', function(e) {
    e.preventDefault();
    const moduleToLoad = $(this).data('module');
    $('.module-content').hide();
    $('#' + moduleToLoad + '-module').show();
    // ... logic to load data for the new module
});
&lt;/script&gt;
</code></pre>

    <hr>

    <h3><strong>Page 6: Frontend Interaction - AJAX & DataTables</strong></h3>
    <h4><strong>6.1. DataTables.js Integration</strong></h4>
    <p>The DataTables.js library is used to transform standard HTML tables into interactive grids with pagination, searching, and sorting, populated with data fetched via AJAX.</p>

    <h4><strong>6.2. Code Snippet: Initializing a DataTable</strong></h4>
    <pre><code>// Specific function to initialize the PRO table
function initializeProTable() {
    if (!$.fn.DataTable.isDataTable('#proTable')) {
        $('#proTable').DataTable({
            responsive: true,
            ajax: { 
                url: 'get_users.php?role=pro', // PHP script providing JSON data
                dataSrc: 'data' // Key in the JSON response holding the data array
            },
            columns: [
                { "data": "pro_uid" },
                { "data": "name" },
                { "data": "email" },
                // ... other columns
                { 
                    "data": null, 
                    "render": function(data, type, row) {
                        return '&lt;button class="btn btn-info"&gt;View&lt;/button&gt;';
                    }
                }
            ]
        });
    } else {
        $('#proTable').DataTable().ajax.reload();
    }
}
</code></pre>

    <hr>

    <h3><strong>Page 7: Frontend Interaction - Form Handling</strong></h3>
    <h4><strong>7.1. Generic Form Submission Logic</strong></h4>
    <p>A reusable JavaScript function, <code>handleFormSubmit</code>, is used to manage AJAX form submissions for creating new users. It prevents default form behavior, sends data using the Fetch API, and updates the UI based on the server's JSON response.</p>

    <h4><strong>Code Snippet:</strong></h4>
    <pre><code>function handleFormSubmit(formId, modalId, tableId, url) {
    $(formId).on('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch(url, { method: 'POST', body: formData })
        .then(response =&gt; response.json())
        .then(data =&gt; {
            alert(data.message);
            if (data.status === 'success') {
                bootstrap.Modal.getInstance(document.getElementById(modalId)).hide();
                if (tableId) {
                    $(tableId).DataTable().ajax.reload();
                }
            }
        });
    });
}

// Usage:
handleFormSubmit('#proForm', 'proModal', '#proTable', 'create_pro.php');
</code></pre>

    <hr>

    <h3><strong>Page 8: A Unique Case - Client-Side Storage</strong></h3>
    <h4><strong>8.1. What is <code>localStorage</code>?</strong></h4>
    <p>In <code>collegedashboard.html</code>, Course and Faculty data is managed using the browser's <code>localStorage</code>. This means the data is stored only in the user's browser and is not persistent on the server or shared between users. This is likely a placeholder for a future database-backed implementation.</p>

    <h4><strong>8.2. Code Snippet: <code>localStorage</code> Management</strong></h4>
    <pre><code>function setupLocalStorageTable(config) {
    const loadData = () =&gt; {
        // Read from localStorage
        const data = JSON.parse(localStorage.getItem(config.storageKey)) || [];
        // Render DataTable with this data
        $(config.tableSelector).DataTable({ data: data, ... });
    };

    $(config.formSelector).on('submit', function(e) {
        e.preventDefault();
        let items = JSON.parse(localStorage.getItem(config.storageKey)) || [];
        // ... logic to add or update an item in the 'items' array
        
        // Write the updated array back to localStorage
        localStorage.setItem(config.storageKey, JSON.stringify(items));
        
        loadData(); // Reload the table
    });
    // ...
}
</code></pre>

    <hr>

    <h3><strong>Page 9: Inferred Database Schema</strong></h3>
    <p>Based on the PHP scripts, the database schema can be inferred.</p>

    <p><strong>Table: <code>admins</code></strong></p>
    <table>
        <thead><tr><th>Column Name</th><th>Data Type</th><th>Notes</th></tr></thead>
        <tbody>
            <tr><td><code>id</code></td><td>INT (PK, AI)</td><td>Primary Key</td></tr>
            <tr><td><code>admin_uid</code></td><td>VARCHAR(255)</td><td>Custom Unique ID</td></tr>
            <tr><td><code>name</code></td><td>VARCHAR(255)</td><td></td></tr>
            <tr><td><code>email</code></td><td>VARCHAR(255)</td><td>UNIQUE</td></tr>
            <tr><td><code>phone</code></td><td>VARCHAR(20)</td><td></td></tr>
            <tr><td><code>role</code></td><td>VARCHAR(50)</td><td>e.g., 'Admin'</td></tr>
            <tr><td><code>password</code></td><td>VARCHAR(255)</td><td>Hashed</td></tr>
        </tbody>
    </table>

    <p><strong>Table: <code>pros</code></strong></p>
    <table>
        <thead><tr><th>Column Name</th><th>Data Type</th><th>Notes</th></tr></thead>
        <tbody>
            <tr><td><code>id</code></td><td>INT (PK, AI)</td><td>Primary Key</td></tr>
            <tr><td><code>pro_uid</code></td><td>VARCHAR(255)</td><td>Custom Unique ID</td></tr>
            <tr><td><code>name</code></td><td>VARCHAR(255)</td><td></td></tr>
            <tr><td><code>email</code></td><td>VARCHAR(255)</td><td>UNIQUE</td></tr>
            <tr><td><code>joining_date</code></td><td>DATE</td><td></td></tr>
            <tr><td><code>password</code></td><td>VARCHAR(255)</td><td>Hashed</td></tr>
            <tr><td><code>created_by_admin_id</code></td><td>INT (FK)</td><td>Foreign Key to <code>admins.id</code></td></tr>
        </tbody>
    </table>
    <p><em>(Similar structures for <code>counselors</code>, <code>colleges</code>, <code>study_centers</code>)</em></p>

    <hr>

    <h3><strong>Page 10: Setup Guide & Recommendations</strong></h3>
    <h4><strong>10.1. Local Development Setup Checklist</strong></h4>
    <ol>
        <li><strong>Install WAMP/MAMP/XAMPP:</strong> Get a local Apache, MySQL, PHP environment.</li>
        <li><strong>Place Project Files:</strong> Copy files to the web server's root (e.g., <code>htdocs</code>).</li>
        <li><strong>Create Database:</strong> Create a database named <code>education_db</code> and create the tables based on the schema from Page 9.</li>
        <li><strong>Configure <code>config.php</code>:</strong> Update database credentials and SMTP settings (use a Gmail App Password).</li>
        <li><strong>Dependencies:</strong> Ensure the <code>PHPMailer/</code> directory is in place.</li>
        <li><strong>Access Application:</strong> Navigate to the project URL in your browser.</li>
    </ol>

    <h4><strong>10.2. Missing Files</strong></h4>
    <p>The following essential backend scripts need to be created:</p>
    <ul>
        <li><code>get_users.php</code>: Fetches user lists by role.</li>
        <li><code>get_admin_profile.php</code> (and others): Manages profile data for each role.</li>
        <li><code>get_dashboard_stats.php</code>: Calculates and returns dashboard summary data.</li>
        <li><code>get_transactions.php</code>: Fetches accounting data.</li>
    </ul>

    <h4><strong>10.3. Recommendations for Future Development</strong></h4>
    <ul>
        <li><strong>Database Migration for <code>localStorage</code> Data:</strong> Move Course and Faculty data to the MySQL database.</li>
        <li><strong>Backend Refactoring:</strong> Consider refactoring the procedural PHP to an Object-Oriented (OOP) structure or a lightweight framework for better maintainability.</li>
        <li><strong>Centralized API Endpoint:</strong> Use a single API endpoint to handle requests instead of multiple individual PHP files.</li>
        <li><strong>Enhanced Security:</strong> Implement more rigorous server-side validation and security headers.</li>
    </ul>

</body>
</html>
